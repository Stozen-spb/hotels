<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Hotels booking test</title>
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/style.css">
<!-- 	<link rel="stylesheet" href="css/style.min.css"> -->
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700&amp;subset=cyrillic" rel="stylesheet">
</head>
<body>
	<div class="wrapper">
		<header>
			<div class="search-controls-container row">
				<div class=" search-controls col-md-6">
					<h1 class="search-title">Выберите отель:</h1>
					<div class="search-buttons-container">
						<select name="city" id="cityHotelsSelect" placeholder="Выберите город..." class="select-city">
							<option value="Moscow">Москва</option>
							<option value="SPb">Санкт-Петербург</option>
						</select>
						
						<div class="search-icon" id="searchForHotels">
							<svg xmlns="http://www.w3.org/2000/svg" class="loopa-logo" viewBox="0 0 16.687 16.688">
								
								<defs>
								    <style>
								      .cls-1 {
								        fill: #d6dfda;
								        fill-rule: evenodd;
								        opacity: 1.0;
								      }
								    </style>
								  </defs>
								  <path id="loopa" class="cls-1" d="M638.155,40.747H637.4l-0.264-.261a6.21,6.21,0,1,0-.675.675l0.263,0.262v0.755l4.773,4.76,1.423-1.422Zm-5.731,0a4.291,4.291,0,1,1,4.3-4.291A4.294,4.294,0,0,1,632.424,40.747Z" transform="translate(-626.219 -30.25)"></path>
								</svg>
						</div>
						
					</div>
					
					

					
				</div>
				<div class="filter-controls-container col-md-6">
					<span class="filter-title">Сортировать результаты:</span>
					<ul class="search-filter">
						<li>
							<input type="radio" name="search-filter" value="rating+" checked>
							<label for="byRatingHigh">По возрастанию рейтинга</label>
						</li>
						<li>
							<input type="radio" name="search-filter" value="rating-">
							<label for="byRatingLow">По убыванию рейтинга</label>
						</li>
						<li>
							<input type="radio" name="search-filter" value="price+">
							<label for="byPriceHigh">По возрастанию стоимости</label>
						</li>
						<li>
							<input type="radio" name="search-filter" value="price-">
							<label for="byRatingLow">По убыванию стоимости</label>
						</li>
					</ul>
					
				</div>
			</div>
			
		</header>
		<section class="search-results container-fluid">
			<div id="mapFilter" class="center-block">
				<div class="map-filters center-block ">
						<label >
						<input  type="radio" name="map-filter" value="all" checked>
						ECVI + Edelweiss
					</label>
					<label > 
						<input  type="radio" name="map-filter" value="ecvi">
						ECVI
					</label>
					<label >
						<input  type="radio" name="map-filter" value="edelweiss">
						Edelweiss
					</label>
				</div>
			</div>

			<div class="col-md-8 col-md-offset-2 google-map" id="map">
			<div class="col-md-8 col-md-offset-2 google-map" id="widgetBron">
			
			</div>
		
		</section>
		
	</div> <!--end of wrapper -->
	<footer id="footer">
			<div class="footer-text">
				Футер 
			</div>
		</footer>
<script src="js/handlebars-v4.0.11.js"></script>
<!-- handlebars template -->
<script id="entry-template" type="text/x-handlebars-template">
	<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 hotel-item">
		<div class="hotel-item-inner" style="background-image: url('{{preview}}'), url('img/noimage.jpg')">
			<div class="hotel-item-top-container">
			<h3 class="hotel-name">{{name}}</h3>
			<div class="hotel-rating"> {{rating}}</div>
			</div>
			<div class="hotel-price"> от {{price}} руб.</div>
			<button class="bookHotel-button"> Забронировать </button>
		</div>

	</div>
</script>	
<script src="js/index.js"> </script>
<script src="js/markerclusterer.js"></script>
<script src='js/mapHotels.js' async defer></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB2rUrL_KgjXVset90geVLBQwZENGq0s30&callback=initMap"
    async defer>
 </script>



<script>
	
      function initMap() {
      	var activeFilter = document.querySelector('input[name=map-filter]:checked').value;
      	var filteredHotels = [];
      	var script = document.createElement('script');
        script.src = 'js/mapHotels.js';
        document.getElementsByTagName('head')[0].appendChild(script);
      	
      	filterHotels(activeFilter);
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 10,
          center: {lat: 59.93, lng: 30.35},
          mapTypeId: 'roadmap'
        });
        var markers = createMarkers();

        // Add a marker clusterer to manage the markers.
	        var markerCluster = new MarkerClusterer(map, markers,
	            {imagePath: 'img/m',
	             maxZoom: 12
	        		});
	        mapFilter.addEventListener('click', function (e){
		
						var newFilter = document.querySelector('input[name=map-filter]:checked').value;

						if (newFilter == activeFilter) {
							activeFilter = newFilter;
							return
						}

						activeFilter = newFilter;
						filterHotels(activeFilter);
						markerCluster.clearMarkers();
						markers = createMarkers();
						markerCluster.addMarkers(markers);

						

					});


	        function filterHotels(filter) {
		        switch(filter){
		      		case 'all':
		      		filteredHotels = hotels;
		      		break;

		      		case 'ecvi':
		      		 filteredHotels = hotels.filter(function(item){
		      			return item.type=='ECVI';
		      		});
		      		break;
		      		case 'edelweiss':
		      		 filteredHotels = hotels.filter(function(item){
		      			return item.type=='EDW';
		      		});
		      		break;
		      		default: console.log('unknown sortType');

		      	}
	        }
	        function createMarkers(){
	        	return filteredHotels.map(function(hotel, i) {
		        	var img = (hotel.type == 'EDW') ? "img/icon-map-marker.svg" : "img/ecvi-marker.svg";

		          return new google.maps.Marker({
		            position: hotel.location,
		            title: hotel.name,
		            icon: {
							url: img,
							scaledSize: new google.maps.Size(40, 40)
						  } 
		           


		          });
		        });

	        }
      }

</script>
<script>
	;(function (d, w, e) {
	   w[e] = w[e] || function(){
        try {
            w.ecviBookingForm = new EcviBookingForm({
                protocol: 'https',
                showOtherHotels: false,
                checkHotelByDefault: true,
                headOfficeID: '260',
                hotelID: '326',
                bookingPath: 'https://stozen-spb.github.io/hotels/bronirovanie',
                token: 'a7e8c0ee-b300-4112-b865-b3dda9ac7ece',
                width: 295,
                height: 420,
                cssPath: '',
                container: 'widgetBron',
                target: 'widget'
            });
        } catch(e) { console.warn( 'Something goes wrong'); }
    }
    var n = d.getElementsByTagName('script')[0],
        s = d.createElement('script'),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = 'text/javascript';
    s.async = true;
    s.src = 'https://hma.ecvi.ru/assets/formreservation/js/iframeCreate/widget.create.js';
    if (w.opera == '[object Opera]') {  
        d.addEventListener('DOMContentLoaded', f, false);
    } else { f(); }
})(document, window, 'ecvi_booking_callback');
</script>
</body>
</html>
